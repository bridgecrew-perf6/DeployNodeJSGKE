pipeline {
     agent {
    kubernetes {
      yaml '''
        apiVersion: v1
        kind: Pod
        spec:
          containers:
          - name: node-jenkins-agent
            image: asia-south1-docker.pkg.dev/model-axe-117106/my-repository/node-jslave:1.0
            command:
            - cat
            tty: true
          - name: kaniko
            image: gcr.io/kaniko-project/executor:debug
            imagePullPolicy: Always
            command:
            - cat
            tty: true
        '''
    }
  }
stages {
stage('Checkout') {
            steps {
                git 'https://github.com/deep1993nov/DeployNodeJSGKE.git'
            }
        }

         stage('Docker Build & Push'){
            steps{
                container("kaniko" , shell: '/busybox/sh'){
                 sh '''#!/busybox/sh
                    /kaniko/executor -f `pwd`/NodeJSProject/app/Dockerfile -c `pwd` --cache=false --destination=asia-south1-docker.pkg.dev/model-axe-117106/my-repository/nodeimage:$BUILD_ID
                    '''

                }
            }
        }

      
}
    
    }
